<div class="dashboard card">
  <div class="welcome">
    <h2>Welcome, {{userName}}!</h2>
    <a href="/logout" class="btn btn-sm">Logout</a>
  </div>

  <div class="generate-section">
    <h3>Generate from YouTube URL</h3>

    <div class="form-group">
      <label for="youtube_url">YouTube URL</label>
      <input type="url" id="youtube_url" placeholder="https://youtube.com/watch?v=..." />
    </div>

    <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
      <select id="ai_model" style="width:220px;padding:10px;border-radius:8px;border:1px solid #e6e9ee">
        <option value="OpenAI">OpenAI (GPT-4)</option>
        <option value="Gemini">Gemini (Coming Soon)</option>
      </select>
      <button onclick="generateFromUrl()" class="btn btn-primary" id="generate-url-btn">Generate Blog</button>
    </div>

    <hr class="sep" />

    <h3>Generate from pasted transcript (recommended)</h3>
    <p class="small">On YouTube: click the three dots → <strong>Open transcript</strong> → copy text → paste here.</p>

    <div class="form-group">
      <textarea id="transcript" placeholder="Paste transcript here..." rows="10"></textarea>
    </div>

    <div style="display:flex;gap:12px;align-items:center">
      <select id="ai_model2" style="width:220px;padding:10px;border-radius:8px;border:1px solid #e6e9ee">
        <option value="OpenAI">OpenAI (GPT-4)</option>
      </select>
      <button onclick="generateFromTranscript()" class="btn btn-primary" id="generate-transcript-btn">Generate Blog</button>
    </div>

    <div id="status-message" style="margin-top:12px"></div>
  </div>

  <div class="posts-section" style="margin-top:18px">
    <h3>Your Posts</h3>
    <div id="posts-list">
      {{posts}}
    </div>
  </div>
</div>

<script>
async function generateFromUrl() {
  const url = document.getElementById('youtube_url').value.trim();
  const model = document.getElementById('ai_model').value;
  if (!url) { alert('Please enter a YouTube URL'); return; }

  const btn = document.getElementById('generate-url-btn');
  btn.disabled = true; btn.textContent = 'Generating...';
  const status = document.getElementById('status-message');
  status.innerHTML = '<div class="alert alert-info">Processing video... this may take a minute.</div>';

  try {
    const res = await fetch('/generate', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ youtube_url: url, ai_model: model })
    });
    const data = await res.json();
    if (data.success) {
      status.innerHTML = `<div class="alert alert-success">Blog generated — <a href="/posts/${data.postId}/edit">Edit</a></div>`;
      setTimeout(()=>location.reload(),1500);
    } else {
      status.innerHTML = `<div class="alert alert-error">${data.error || 'Failed to generate'}</div>`;
    }
  } catch (e) {
    status.innerHTML = `<div class="alert alert-error">An error occurred. Try again.</div>`;
  } finally {
    btn.disabled=false; btn.textContent='Generate Blog';
  }
}

async function generateFromTranscript() {
  const transcript = document.getElementById('transcript').value.trim();
  const model = document.getElementById('ai_model2').value;
  if (!transcript) { alert('Please paste the transcript'); return; }

  const btn = document.getElementById('generate-transcript-btn');
  btn.disabled=true; btn.textContent='Generating...';
  const status = document.getElementById('status-message');
  status.innerHTML = '<div class="alert alert-info">Sending transcript to AI... this may take a moment.</div>';

  try {
    const res = await fetch('/generate', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ transcript: transcript, ai_model: model })
    });
    const data = await res.json();
    if (data.success) {
      status.innerHTML = `<div class="alert alert-success">Blog generated — <a href="/posts/${data.postId}/edit">Edit</a></div>`;
      setTimeout(()=>location.reload(),1500);
    } else {
      status.innerHTML = `<div class="alert alert-error">${data.error || 'Failed to generate'}</div>`;
    }
  } catch (e) {
    status.innerHTML = `<div class="alert alert-error">An error occurred. Try again.</div>`;
  } finally {
    btn.disabled=false; btn.textContent='Generate Blog';
  }
}
</script>
