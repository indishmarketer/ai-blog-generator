<section>
  <h2>Welcome, {{userName}}</h2>

  <div class="card">
    <h3>Generate from YouTube URL</h3>
    <form id="youtube-form">
      <label for="youtube_url">YouTube URL</label>
      <input id="youtube_url" name="youtube_url" placeholder="https://www.youtube.com/watch?v=..." style="width:100%">
      <label for="ai_model">Model</label>
      <select id="ai_model" name="ai_model">
        <option value="OpenAI" selected>OpenAI</option>
        <option value="Gemini">Gemini (stub)</option>
      </select>
      <button id="youtube-generate" type="button" class="btn">Generate Blog</button>
    </form>
    <div id="youtube-result"></div>
  </div>

  <div class="card">
    <h3>Generate from pasted transcript (recommended)</h3>
    <p>On YouTube: click the three dots → <strong>Open transcript</strong> → copy text → paste here.</p>
    <form id="transcript-form">
      <textarea id="transcript-input" name="transcript" rows="10" style="width:100%" placeholder="Paste transcript here..."></textarea>
      <label for="ai_model_transcript">Model</label>
      <select id="ai_model_transcript" name="ai_model">
        <option value="OpenAI" selected>OpenAI</option>
        <option value="Gemini">Gemini (stub)</option>
      </select>
      <button id="transcript-generate" type="button" class="btn">Generate Blog</button>
    </form>
    <div id="transcript-result"></div>
  </div>

  <hr>
  <h3>Your Posts</h3>
  <div id="posts-list">
    {{posts}}
  </div>

  <p><a href="/logout" class="btn">Logout</a></p>
</section>

<script>
  async function postJson(url, body) {
    const res = await fetch(url, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    return res.json();
  }

  document.getElementById('youtube-generate').addEventListener('click', async () => {
    const btn = document.getElementById('youtube-generate');
    btn.disabled = true;
    btn.innerText = 'Generating...';
    const url = document.getElementById('youtube_url').value.trim();
    const model = document.getElementById('ai_model').value;
    if (!url) { alert('Enter YouTube URL'); btn.disabled=false; btn.innerText='Generate Blog'; return; }
    try {
      const data = await postJson('/generate', { youtube_url: url, ai_model: model });
      if (data.success) window.location.href = `/posts/${data.postId}/edit`;
      else alert(data.error || 'Failed to generate');
    } catch (err) {
      console.error(err);
      alert('Error generating from YouTube');
    } finally { btn.disabled=false; btn.innerText='Generate Blog'; }
  });

  document.getElementById('transcript-generate').addEventListener('click', async () => {
    const btn = document.getElementById('transcript-generate');
    btn.disabled = true;
    btn.innerText = 'Generating...';
    const txt = document.getElementById('transcript-input').value.trim();
    const model = document.getElementById('ai_model_transcript').value;
    if (!txt || txt.length < 20) { alert('Paste a transcript'); btn.disabled=false; btn.innerText='Generate Blog'; return; }
    try {
      const data = await postJson('/generate-from-transcript', { transcript: txt, ai_model: model });
      if (data.success) window.location.href = `/posts/${data.postId}/edit`;
      else alert(data.error || 'Failed to generate');
    } catch (err) {
      console.error(err);
      alert('Error generating from transcript');
    } finally { btn.disabled=false; btn.innerText='Generate Blog'; }
  });
</script>
