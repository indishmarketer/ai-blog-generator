<div class="dashboard">
    <div class="welcome">
        <h2>Welcome, {{userName}}!</h2>
        <a href="/logout" class="btn btn-sm">Logout</a>
    </div>
    
    <div class="generate-section">
        <h3>Generate New Blog Post</h3>
        
        <div id="generate-form">
            <div class="form-group">
                <label for="youtube_url">YouTube URL</label>
                <input type="url" id="youtube_url" placeholder="https://youtube.com/watch?v=..." required>
            </div>
            
            <div class="form-group">
                <label for="ai_model">AI Model</label>
                <select id="ai_model">
                    <option value="OpenAI">OpenAI (GPT-4)</option>
                    <option value="Gemini">Gemini (Coming Soon)</option>
                </select>
            </div>
            
            <button onclick="generateBlog()" class="btn btn-primary" id="generate-btn">Generate Blog</button>
            
            <div id="status-message"></div>
        </div>
    </div>
    
    <div class="posts-section">
        <h3>Your Blog Posts</h3>
        <div id="posts-list">
            {{posts}}
        </div>
    </div>
</div>

<script>
async function generateBlog() {
    const youtubeUrl = document.getElementById('youtube_url').value;
    const aiModel = document.getElementById('ai_model').value;
    const statusDiv = document.getElementById('status-message');
    const generateBtn = document.getElementById('generate-btn');
    
    if (!youtubeUrl) {
        alert('Please enter a YouTube URL');
        return;
    }
    
    // Disable button and show status
    generateBtn.disabled = true;
    generateBtn.textContent = 'Generating...';
    statusDiv.innerHTML = '<div class="alert alert-info">Processing video... This may take a minute.</div>';
    
    try {
        const response = await fetch('/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                youtube_url: youtubeUrl,
                ai_model: aiModel
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            statusDiv.innerHTML = `<div class="alert alert-success">Blog post generated successfully! <a href="/posts/${data.postId}/edit">View/Edit</a></div>`;
            document.getElementById('youtube_url').value = '';
            // Reload page after 2 seconds to show new post
            setTimeout(() => window.location.reload(), 2000);
        } else {
            statusDiv.innerHTML = `<div class="alert alert-error">${data.error}</div>`;
        }
    } catch (error) {
        statusDiv.innerHTML = '<div class="alert alert-error">An error occurred. Please try again.</div>';
    } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = 'Generate Blog';
    }
}
</script>