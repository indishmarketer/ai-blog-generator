<section>
  <h2>Edit Post</h2>
  <form id="post-save-form">
    <input id="title" name="title" value="{{title}}" style="width:100%" />
    <label>Meta description</label>
    <input id="meta_description" name="meta_description" value="{{metaDescription}}" style="width:100%" />
    <label>SEO keywords (comma separated)</label>
    <input id="seo_keywords" name="seo_keywords" value="{{seoKeywords}}" style="width:100%" />
    <label>Summary</label>
    <textarea id="summary" name="summary" rows="3" style="width:100%">{{summary}}</textarea>
    <label>Content (HTML)</label>
    <textarea id="content_html" name="content_html" rows="15" style="width:100%">{{content}}</textarea>

    <div style="margin-top:10px;">
      <button type="button" id="save-btn" class="btn">Save</button>
      <a id="download-btn" class="btn" href="/posts/{{postId}}/download">Download HTML</a>
      <a href="/dashboard" class="btn">Back to Dashboard</a>
    </div>
  </form>
</section>

<script>
  document.getElementById('save-btn').addEventListener('click', async () => {
    const btn = document.getElementById('save-btn');
    btn.disabled = true;
    btn.innerText = 'Saving...';
    const payload = {
      title: document.getElementById('title').value,
      meta_description: document.getElementById('meta_description').value,
      seo_keywords: document.getElementById('seo_keywords').value,
      summary: document.getElementById('summary').value,
      content_html: document.getElementById('content_html').value
    };
    const id = '{{postId}}';
    try {
      const res = await fetch(`/posts/${id}/save`, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (data.success) alert('Saved!');
      else alert('Save failed');
    } catch (err) {
      console.error(err);
      alert('Error saving');
    } finally {
      btn.disabled = false;
      btn.innerText = 'Save';
    }
  });
</script>
